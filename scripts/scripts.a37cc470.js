String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return this.substr(b||0,a.length)===a}),function(){function a(a,b){b.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|data|chrome-extension):/),a.when("/admin/:area/:section?/:subsection?",{templateUrl:"views/admin.html",controller:"AdminCtrl"}).when("/admin",{redirectTo:"/admin/categories/achievements/quests"}).when("/error/:realm/:character",{templateUrl:"views/error.html",controller:"ErrorCtrl"}).when("/:region/:realm/:character/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).when("/:region/:realm/:character/achievements/:category",{templateUrl:"views/achievements.html",controller:"AchievementsCtrl"}).when("/:region/:realm/:character/collectable/battlepets",{templateUrl:"views/battlePets.html",controller:"BattlePetsCtrl"}).when("/:region/:realm/:character/calendar",{templateUrl:"views/calendar.html",controller:"CalendarCtrl"}).when("/:region/:realm/:character/collectable/companions",{templateUrl:"views/companions.html",controller:"CompanionsCtrl"}).when("/:region/:realm/:character/collectable/mounts",{templateUrl:"views/mounts.html",controller:"MountsCtrl"}).when("/:region/:realm/:character/collectable/toys",{templateUrl:"views/toys.html",controller:"ToysCtrl"}).when("/:region/:realm/:character",{templateUrl:"views/overview.html",controller:"OverviewCtrl"}).when("/:region/:realm/:character/reputation",{templateUrl:"views/reputation.html",controller:"ReputationCtrl"}).when("/",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/login"})}angular.module("simpleArmoryApp",["ngRoute","ngSanitize","ui.bootstrap","ui.select"]).config(a),a.$inject=["$routeProvider","$compileProvider"]}(),function(){function a(a,b,c,d,e){function f(a){var b=a;switch(a){case"character":b="Персонаж";break;case"quests":b="Задания";break;case"exploration":b="Исследования";break;case"pvp":b="Player vs. Player";break;case"dungeons":b="Подземелья и Рейды";break;case"professions":b="Профессии";break;case"reputation":b="Репутация";break;case"events":b="Игровые события";break;case"pets":b="Битвы питомцев";break;case"collections":b="Коллекции";break;case"expansions":b="Особый контент";break;case"legacy":b="Наследие";break;case"feats":b="Великие подвиги"}return b}a.superCat=f(c.category),a.settings=e,d.ga("send","pageview","Achievements/"+c.category),b.getAchievements().then(function(b){a.achievements=b[a.superCat]}),a.getImageSrc=function(a){return"8468"===a.id&&a.completed?"images/galakras.ff0c0031.png":"9552"===a.id&&a.completed?"images/spell_fel_incinerate.0253c2a6.jpg":a.completed?"//wow.zamimg.com/images/wow/icons/medium/"+a.icon.toLowerCase()+".jpg":"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},a.border=function(a){return a.completed?"borderOff":"borderOn"}}angular.module("simpleArmoryApp").controller("AchievementsCtrl",a),a.$inject=["$scope","AchievementsService","$routeParams","$window","SettingsService"]}(),function(){function a(a,b,c,d,e,f){a.isLoggedIn=!1,a.$on("$locationChangeSuccess",function(){if(0===c.$$path.lastIndexOf("/error",0))a.character=null,a.isLoggedIn=!1;else if("/login"===c.$$path)c.url("/");else if(""!==c.$$path&&"/"!==c.$$path&&!c.$$path.startsWith("/admin")){var d=new RegExp("([^/]+)/([^/]+)/([^/]+)/?([^/]+)?").exec(c.$$path);d=d?d:{},b.getCharacter({region:d[1],realm:d[2],character:d[3]}).then(function(b){a.character=b,a.isLoggedIn=!0})}}),e.init(f.trigger),a.percent=function(a,b){return d("number")(a/b*100,0)},a.achFormater=function(b,c){if(!b||!c)return"";var d=a.percent(b,c);return 18>d?d+"%":""+b+" / "+c+" ("+d+"%)"},a.getImageSrc=function(a,b){return b=b||a.collected,b?"//wow.zamimg.com/images/wow/icons/medium/"+a.icon.toLowerCase()+".jpg":"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},a.createSimpleGuid=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)+(65536*(1+Math.random())|0).toString(16).substring(1)},a.qualityToBackground=function(a){var b="#fff";switch(a.quality){case"poor":b="#7F7F7F";break;case"common":b="#F0F0F0";break;case"uncommon":b="#22B14C";break;case"rare":b="#3F48CC"}return"background:"+b}}angular.module("simpleArmoryApp").controller("ApplicationCtrl",a),a.$inject=["$scope","LoginService","$location","$filter","KeyboardService","KonamiService"]}(),function(){function a(a,b,c,d){a.settings=d,c.ga("send","pageview","BattlePets"),b.getItems("battlepets","pets","creatureId").then(function(b){a.items=b})}angular.module("simpleArmoryApp").controller("BattlePetsCtrl",a),a.$inject=["$scope","MountsAndPetsService","$window","SettingsService"]}(),function(){function a(a,c,d,e,f,g){function h(b,c){var e=["","Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],f=[],g=new Date,h={},j="";angular.forEach(b,function(a){angular.forEach(a.categories,function(a){angular.forEach(a.subcats,function(a){angular.forEach(a.achievements,function(a){if(a.completed){var b=new Date(a.completed),c=""+b.getFullYear()+(b.getMonth()<9?"0":"")+(b.getMonth()+1);h[c]||(h[c]=new Array(31)),h[c][b.getDate()]||(h[c][b.getDate()]=[]),h[c][b.getDate()].push(a),h[c].hasAchievements=!0}})})})});for(var k=0,l=!1,m=2008;m<=g.getFullYear();m++)for(var n=1;12>=n;n++){var o=""+m+(10>n?"0":"")+n,p=m===g.getFullYear()&&n===g.getMonth()+1;if(l||h[o]&&h[o].hasAchievements){l=!0;var q=i(n,m,h,c);if(j+='<table class="calendar'+(p?" curCalendar":"")+'" id="calendar'+o+'" style="display: '+(p?"block":"none")+'">',j+=q.rows,j+="</table>",f.push({value:o,text:e[n]+" "+m,index:k++,total:q.total,points:q.points}),p)break}}a.tableHtml=d.trustAsHtml(j),a.months=f}function i(c,d,e,f){for(var g,h="",i=0,j=0,k=f.charAt(0).toUpperCase()+f.slice(1),l=""+d+(10>c?"0":"")+c,m=1;31>=m&&(g=new Date(d,c-1,m),g.getDate()===m);m++){if((1===m||0===g.getDay())&&(h+="<tr>"),1===m&&g.getDay()>0&&(h+='<td colspan="'+g.getDay()+'" class="dayspacer"></td>'),h+="<td>"+m,e[l]&&e[l][m]){var n=e[l][m];n.sort(b),h+="<div>",angular.forEach(n,function(b){h+='<a target="'+a.settings.anchorTarget+'" href="//'+a.settings.WowHeadUrl+"/achievement="+b.id+'" rel="who='+k+"&amp;when="+b.completed+'"><img src="//wow.zamimg.com/images/wow/icons/medium/'+b.icon.toLowerCase()+'.jpg" width="36" height="36" border="0"></a>',i++,j+=b.points}),h+="</div>"}h+="</td>",6===g.getDay()&&(h+="</tr>")}return g.getDay()<6&&(h+='<td colspan="'+(6-g.getDay())+'" class="dayspacer"></td>'),h+="</tr>",{rows:h,total:i,points:j}}a.settings=g,f.ga("send","pageview","Calendar"),c.getAchievements().then(function(b){h(b,e.character),a.selectedMonth=a.months[a.months.length-1],a.selectionChanged()}),a.leftOneMonth=function(){a.selectedMonth.index>0&&(a.selectedMonth=a.months[a.selectedMonth.index-1],a.selectionChanged())},a.rightOneMonth=function(){a.selectedMonth.index<a.months.length-1&&(a.selectedMonth=a.months[a.selectedMonth.index+1],a.selectionChanged())},a.selectionChanged=function(){var b=$(".curCalendar");b.removeClass("curCalendar"),b.hide();var c=$("#calendar"+a.selectedMonth.value);c.addClass("curCalendar"),c.show(),a.totalForMonth=a.selectedMonth.total,a.totalPoints="("+a.selectedMonth.points+" points)"}}function b(a,b){return a.completed===b.completed?parseInt(a.id,10)<parseInt(b.id,10)?-1:1:a.completed<b.completed?-1:1}angular.module("simpleArmoryApp").controller("CalendarCtrl",a),a.$inject=["$scope","AchievementsService","$sce","$routeParams","$window","SettingsService"]}(),function(){function a(a,b,c,d){a.settings=d,c.ga("send","pageview","Companions"),b.getItems("pets","pets","spellId").then(function(b){a.items=b})}angular.module("simpleArmoryApp").controller("CompanionsCtrl",a),a.$inject=["$scope","MountsAndPetsService","$window","SettingsService"]}(),function(){function a(a,b,c){c.ga("send","pageview","Error"),a.character=b.character,a.realm=b.realm}angular.module("simpleArmoryApp").controller("ErrorCtrl",a),a.$inject=["$scope","$routeParams","$window"]}(),function(){function a(a,b){function c(a){return a?"/"+a.region.toLowerCase()+"/"+a.realm.toLowerCase()+"/"+a.name.toLowerCase():""}a.isCollapsed=!0,a.getUrl=function(b){var d="#"+c(a.character);return""!==b&&(d+="/"+b),d},a.isActive=function(d,e){if(e)return b.path().indexOf(d)>0;var f=c(a.character);return""!==d&&(f+="/"+d),b.path()===f},a.guildName=function(){return a.character&&a.character.guild?"<"+a.character.guild.name+">":""},a.imgUrl=function(){if(a.character){var b=a.character;return window.location.protocol+"//render-"+b.region+".worldofwarcraft.com/character/"+b.thumbnail}return""},a.armoryUrl=function(){if(a.character){var b=a.character;return window.location.protocol+"//"+b.region+".battle.net/wow/en/character/"+b.realm+"/"+b.name.toLowerCase()+"/advanced"}return"#"}}angular.module("simpleArmoryApp").controller("HeaderCtrl",a),a.$inject=["$scope","$location"]}(),function(){function a(a,b,c,d,e){var f=c.open({templateUrl:"ModelLogin.html",controller:"ModalInstanceCtrl",backdrop:"static"});f.result.then(function(a){d.url(a.region+"/"+a.realm+"/"+a.character)}),b.$on("$routeChangeSuccess",function(){f.dismiss()})}function b(a,b,c,d){a.realms=[],a.selectedRealm={},a.selectPlaceholder="Загружаю список серверов...",a.isDisabled=!0,a.regionGroupFn=function(a){return"us"===a.region.toLowerCase()?"US":"EU"},c.getAllRealms().then(function(b){a.selectPlaceholder="Выбери сервер...",a.isDisabled=!1,1===a.realms.length&&(a.realms=[]),a.realms=b,a.$broadcast("SetFocus")}),a.ok=function(){b.close({region:a.selectedRealm.selected.region,realm:a.selectedRealm.selected.slug,character:a.characterName})}}angular.module("simpleArmoryApp").controller("LoginCtrl",a).controller("ModalInstanceCtrl",b),a.$inject=["$scope","$rootScope","$modal","$location","$timeout"],b.$inject=["$scope","$modalInstance","BlizzardRealmService","$timeout"]}(),function(){function a(a,b,c,d,e){a.settings=e,d.ga("send","pageview","Mounts"),a.anchorCss=function(a){return a.epic?"mnt-plan-epic":"mnt-plan-rare"},a.getPlanImageSrc=function(a){return a.icon?"//wow.zamimg.com/images/wow/icons/tiny/"+a.icon+".gif":""},b.getItems("mounts","mounts","spellId").then(function(b){a.items=b,a.plannerChanged=function(){a.showPlanner&&(d.ga("send","pageview","Planner"),c.getSteps(b).then(function(b){a.plannerReturned=!0,a.planner=b}))},a.getPlanStepImageSrc=function(a){return a.capital?b.isAlliance?"images/alliance.20064771.png":"images/horde.b8723327.png":a.hearth?"images/hearth.81f1329f.png":""},a.getStepTitle=function(a){return a.capital?a.title+(b.isAlliance?"Stormwind":"Orgrimmar"):a.title}})}angular.module("simpleArmoryApp").controller("MountsCtrl",a),a.$inject=["$scope","MountsAndPetsService","PlannerService","$window","SettingsService"]}(),function(){function a(a,b,c,d){d.ga("send","pageview","Overview"),b.getAchievements().then(function(b){a.achievements=b}),a.baseUrl="#"+c.$$path}angular.module("simpleArmoryApp").controller("OverviewCtrl",a),a.$inject=["$scope","AchievementsService","$location","$window"]}(),function(){function a(a,b,c){c.ga("send","pageview","Reputation"),b.getFactions().then(function(b){a.items=b})}angular.module("simpleArmoryApp").controller("ReputationCtrl",a),a.$inject=["$scope","FactionsService","$window"]}(),function(){function a(a,b,c){c.ga("send","pageview","Settings")}angular.module("simpleArmoryApp").controller("SettingsCtrl",a),a.$inject=["$scope","$location","$window"]}(),function(){function a(a,b,c,d){a.settings=d,a.toyString="",a.showExport=null===localStorage.getItem("toys"),c.ga("send","pageview","Toys"),b.getItems().then(function(b){a.items=b}),a.save=function(){try{JSON.parse(a.toyString)}catch(c){return}localStorage.setItem("toys",a.toyString),b.getItems(!0).then(function(b){a.items=b})},a.cancel=function(){a.showExport=!1}}angular.module("simpleArmoryApp").controller("ToysCtrl",a),a.$inject=["$scope","ToysService","$window","SettingsService"]}(),function(){function a(a,b,c,d,e,f){var g,h,i,j,k=[];return{onLogin:function(a){k.push(a)},getCharacter:function(l,m){function n(){b.error("Trouble fetching character from battlenet"),e.ga("send","event","LoginError",l.region+":"+l.realm+":"+l.character),a.url("error/"+l.realm+"/"+l.character)}function o(a){return e.ga("send","event","Login",l.region+":"+l.realm+":"+l.character),g=a.data,g.region=l.region,g.faction=["","A","H","A","A","H","H","A","H","H","H","A","","","","","","","","","","","A","","","A","H","H","H","A","A","","","","A","","H"][g.race],h=l.region,i=l.realm,j=l.character,g}function p(a,b,c){return a&&h&&a.toLowerCase()===h.toLowerCase()&&b&&i&&b.toLowerCase()===i.toLowerCase()&&c&&j&&c.toLowerCase()===j.toLowerCase()?!0:!1}var q=p(l.region,l.realm,l.character);if(q&&g)return d.when(g);if(!q)for(var r=0;r<k.length;r++)k[r]("logged in");return b.log("Fetching "+l.character+" from server "+l.realm+"..."),c.get(f.apiEndPoint+l.region+"/"+l.realm+"/"+l.character,{cache:!0}).error(n).then(o)}}}angular.module("simpleArmoryApp").factory("LoginService",a),a.$inject=["$location","$log","$http","$q","$window","SettingsService"]}(),function(){function a(a,d,e,f){return{getMissingMounts:function(){var b=f.defer();return f.all([a.get(e.jsonFiles.mounts,{isArray:!0}).then(function(a){var b=a.data,c={};for(var d in b){var e=b[d];for(var f in e.subcats){var g=e.subcats[f];for(var h in e.subcats[f].items){var i=g.items[h];c[i.spellid]=i}}}return c}),a.jsonp("https://us.api.battle.net/wow/mount/?locale=en_US&apikey=kwptv272nvrashj83xtxcdysghbkw6ep&jsonp=JSON_CALLBACK",{cache:!0}).then(function(a){return a})]).then(function(a){var d=[],e=a[0],f=a[1].data.mounts;for(var g in f){var h=f[g];if(!e[h.spellId]&&!c[h.spellId]){h.spellId||console.log("WARN: mount doesn't have spellId: "+h.name),h.itemId||console.log("WARN: mount doesn't have itemId spellId: "+h.spellId+" name: "+h.name),h.icon||console.log("ERROR: mount doesn't have icon: "+h.name);var i={icon:h.icon,name:h.name};h.spellId&&(i.spellid=h.spellId),h.itemId&&(i.itemId=h.itemId),d.push(i)}}b.resolve(d)}),b.promise},getMissingAchievements:function(){var c=f.defer();return f.all([a.get(e.jsonFiles.achievements).then(function(a){var b={};for(var c in a.data.supercats){var d=a.data.supercats[c];for(var e in d.cats){var f=d.cats[e];for(var g in f.subcats){var h=f.subcats[g];for(var i in h.items){var j=h.items[i];b[j.id]=j}}}}return b}),a.jsonp("https://us.api.battle.net/wow/data/character/achievements?locale=en_US&apikey=kwptv272nvrashj83xtxcdysghbkw6ep&jsonp=JSON_CALLBACK",{cache:!0}).then(function(a){return a}),a.get("/criteria/").then(function(a){return a.data})]).then(function(a){var d=[],e=a[0],f=a[1].data.achievements,g=a[2];for(var h in f){var i=f[h];for(var j in i.categories){var k=i.categories[j];for(var l in k.achievements){var m=k.achievements[l];b(m,e,d,g)}}for(var n in i.achievements){var o=i.achievements[n];b(o,e,d,g)}}c.resolve(d)}),c.promise},getMountData:function(){return a.get(e.jsonFiles.mounts,{cache:!0,isArray:!0}).then(function(a){return a.data})},getAchievementData:function(){return a.get(e.jsonFiles.achievements,{cache:!0}).then(function(a){return a.data})}}}function b(a,b,c,e){if(!b[a.id]&&!d[a.id]){if(a.criteria&&a.criteria.length>1){var f={},g=e[a.id];for(var h in g)if(g.hasOwnProperty(h)){var i=g[h];i.forEach(function(a){var b=a[1];f[b]=h})}a.criteria=f}else delete a.criteria;console.log("NOT FOUND: "+a.id+" - "+a.title+"..."),c.push(a)}}angular.module("simpleArmoryApp").service("AdminService",a);var c={17458:!0,147595:!0,127178:!0,127180:!0,127213:!0,123160:!0,127272:!0,127274:!0,123182:!0,127278:!0,127209:!0,215545:!0,10788:!0,10790:!0,171618:!0,48954:!0,242896:!0,242897:!0,459:!0,581:!0,578:!0,579:!0,15780:!0,33630:!0,10795:!0,468:!0,8980:!0,64656:!0,6896:!0,18363:!0,49378:!0,66123:!0,66122:!0,66124:!0,60136:!0,60140:!0,55164:!0,59572:!0,28828:!0,44317:!0,194046:!0,62048:!0,239363:!0,239767:!0,239766:!0},d={7268:!0,7269:!0,7270:!0,8812:!0};a.$inject=["$http","$log","SettingsService","$q"]}(),function(){function a(a,b,c,d,e,f,g){function h(a,c,d,e){var f={},g={},h={},i=0,k=0,l=0,m=0,n={};b.log("Parsing achievements.json..."),angular.forEach(c.achievements.criteria,function(a,b){h[a]=!0}),angular.forEach(c.achievements.achievementsCompleted,function(a,b){g[a]=c.achievements.achievementsCompletedTimestamp[b],c.achievements.achievementsCompletedTimestamp[b]||(g[a]=d.fakeCompletionTime),n[a]=!1}),angular.forEach(a,function(a){var b=0,e=0;f[a.name]={},f[a.name].categories=[],angular.forEach(a.cats,function(j){var o={name:j.name,subcats:[]};angular.forEach(j.subcats,function(f){var j={name:f.name,achievements:[]};angular.forEach(f.items,function(f){n[f.id]=!0;var o=f,p=!1;if(o.completed=g[f.id],!o.completed&&d.debug&&(o.completed=d.fakeCompletionTime),o.completed&&o.completed!==d.fakeCompletionTime&&(o.rel="who="+c.name+"&when="+o.completed),o.completed)p=!0,j.achievements.push(o),"Великие подвиги"===a.name?l++:"Наследие"===a.name&&m++;else if(f.criteria){var q=[];angular.forEach(f.criteria,function(a,b){h[b]&&q.push(a)}),q.length>0&&(o.rel="cri="+q.join(":"))}"Великие подвиги"===a.name||"Наследие"===a.name||f.notObtainable||f.side&&f.side!==c.faction||(b++,i++,o.completed&&(e++,k++),p||j.achievements.push(o))}),j.achievements.length>0&&o.subcats.push(j)}),f[a.name].categories.push(o)}),f[a.name].possible=b,f[a.name].completed=e,"Великие подвиги"===a.name?f[a.name].foSTotal=l:"Наследие"===a.name&&(f[a.name].legacyTotal=m)});for(var o in n)!n.hasOwnProperty(o)||n[o]||j[o]||(e.ga("send","event","MissingAchievement",o),console.log('WARN: Found achievement "'+o+'" from character but not in db.'));return f.possible=i,f.completed=k,f}var i,j={10050:!0,10051:!0};return c.onLogin(function(){i=void 0}),{getAchievements:function(){return i?f.when(i):c.getCharacter({region:d.region,realm:d.realm,character:d.character}).then(function(b){return a.get("data/achievements.4ee5f14f.json",{cache:!0}).then(function(a){return i=h(a.data.supercats,b,e,g)})})}}}angular.module("simpleArmoryApp").factory("AchievementsService",a),a.$inject=["$http","$log","LoginService","$routeParams","SettingsService","$q","$window"]}(),function(){function a(a,b,c,d){return{getAllRealms:function(){var c=b.defer();return b.all([a.get("data/servers.us.d0266556.json").then(function(a){return console.log("Got realms for US"),a}),a.get("data/servers.eu.8dcd7aa6.json").then(function(a){return console.log("Got realms for EU"),a})]).then(function(a){for(var b,d=[],e=0;e<a[0].data.realms.length;e++)b=a[0].data.realms[e],b.region="us",d.push(b);for(e=0;e<a[1].data.realms.length;e++)b=a[1].data.realms[e],b.region="eu",d.push(b);c.resolve(d)}),c.promise}}}angular.module("simpleArmoryApp").factory("BlizzardRealmService",a),a.$inject=["$http","$q","$log","$window"]}(),function(){function a(a,b,c,d,e,f,g){function h(a,b,c,d){var f={categories:[]},g={},h=0,j=0,k={},l=JSON.parse(localStorage.getItem("toys"));if(b.toys={},b.toys.collected=[],angular.forEach(l,function(a){b.toys.collected.push({itemId:a})}),angular.forEach(b[c].collected,function(a){g[a[d]]=a,k[a[d]]=!1}),i(b,c,g,k),angular.forEach(a,function(a){var c={name:a.name,subCategories:[]};f.categories.push(c),angular.forEach(a.subcats,function(a){var e={name:a.name,items:[]};angular.forEach(a.items,function(a){var c=a;if(c.spellId=a.spellid,delete c.spellid,k[c[d]]=!0,g[c[d]]){var f=g[c[d]];if(c.collected=!0,f.qualityId){var i="";switch(f.qualityId){case 0:i="poor";break;case 1:i="common";break;case 2:i="uncommon";break;case 3:i="rare";break;case 4:i="epic";break;case 5:i="legendary"}c.quality=i}if(f.stats){if(f.stats.breedId){var l="";switch(f.stats.breedId){case 4:case 14:l="P/P";break;case 5:case 15:l="S/S";break;case 6:case 16:l="H/H";break;case 7:case 17:l="H/P";break;case 8:case 18:l="P/S";break;case 9:case 19:l="H/S";break;case 10:case 20:l="P/B";break;case 11:case 21:l="S/B";break;case 12:case 22:l="H/B";break;case 3:case 13:l="B/B"}c.breed=l}c.level=f.stats.level}}var m="spell="+c.spellId;a.itemId?m="item="+a.itemId:a.allianceId&&"A"===b.faction?m="item="+a.allianceId:a.hordeId&&"H"===b.faction?m="item="+a.hordeId:a.creatureId&&(m="npc="+a.creatureId),c.link=m;var n=c.collected,o=n||!a.notObtainable;if(a.side&&a.side!==b.faction&&(o=!1),a.allowableRaces&&a.allowableRaces.length>0){var p=!1;angular.forEach(a.allowableRaces,function(a){a===b.race&&(p=!0)}),p||(o=!1)}if(a.allowableClasses&&a.allowableClasses.length>0){var q=!1;angular.forEach(a.allowableClasses,function(a){a===b["class"]&&(q=!0)}),q||(o=!1)}o&&(e.items.push(c),n&&h++,j++)}),e.items.length>0&&c.subCategories.push(e)})}),"creatureId"!==d)for(var m in k)"0"===m||!k.hasOwnProperty(m)||k[m]||n[m]||(e.ga("send","event","MissingCollection",m),console.log('WARN: Found item "'+m+'" from character but not in db.'));return f.collected=h,f.possible=j,f.lookup=g,f.isAlliance="A"===b.faction,f}function i(a,b,c,d){}var j,k,l,m,n={10708:!0,132785:!0,148065:!0,148068:!0,148069:!0};return c.onLogin(function(){j=void 0,k=void 0,l=void 0,m=void 0}),{getItems:function(e,i,n){return"pets"===e&&k?f.when(k):"battlepets"===e&&l?f.when(l):"mounts"===e&&j?f.when(j):"toys"===e&&m?f.when(m):c.getCharacter({region:d.region,realm:d.realm,character:d.character}).then(function(c){return a.get(g.jsonFiles[e],{cache:!0,isArray:!0}).then(function(a){b.log("Parsing "+e+".json...");var d=h(a.data,c,i,n);return"pets"===e?k=d:"battlepets"===e?l=d:"mounts"===e?j=d:"toys"===e&&(m=d),d})})}}}angular.module("simpleArmoryApp").factory("MountsAndPetsService",a),a.$inject=["$http","$log","LoginService","$routeParams","$window","$q","SettingsService"]}(),function(){function a(a,b,c,d,e,f,g){function h(a,b,c){var d={categories:[]},f={},g="itemId",h="toys",i=0,j=0,k={},l=JSON.parse(localStorage.getItem("toys"));b.toys={},b.toys.collected=[],angular.forEach(l,function(a){b.toys.collected.push({itemId:a})}),angular.forEach(b[h].collected,function(a){f[a[g]]=a,k[a[g]]=!1}),angular.forEach(a,function(a){var c={name:a.name,subCategories:[]};d.categories.push(c),angular.forEach(a.subcats,function(a){var d={name:a.name,items:[]};angular.forEach(a.items,function(a){var c=a;if(k[c[g]]=!0,f[c[g]]){f[c[g]];c.collected=!0}c.link="item="+a.itemId;var e=c.collected,h=e||!a.notObtainable;if(a.side&&a.side!==b.faction&&(h=!1),a.allowableRaces&&a.allowableRaces.length>0){var l=!1;angular.forEach(a.allowableRaces,function(a){a===b.race&&(l=!0)}),l||(h=!1)}if(a.allowableClasses&&a.allowableClasses.length>0){var m=!1;angular.forEach(a.allowableClasses,function(a){a===b["class"]&&(m=!0)}),m||(h=!1)}h&&(d.items.push(c),e&&i++,j++)}),d.items.length>0&&c.subCategories.push(d)})});for(var m in k)"0"!==m&&k.hasOwnProperty(m)&&!k[m]&&(e.ga("send","event","MissingCollection",m),console.log('WARN: Found item "'+m+'" from character but not in db.'));return d.collected=i,d.possible=j,d.lookup=f,d}var i;return c.onLogin(function(){i=void 0}),{getItems:function(e){if(i&&!e)return f.when(i);var j="toys";return c.getCharacter({region:d.region,realm:d.realm,character:d.character}).then(function(c){return a.get(g.jsonFiles[j],{cache:!0,isArray:!0}).then(function(a){b.log("Parsing "+j+".json...");var d=h(a.data,c);return i=d,d})})}}}angular.module("simpleArmoryApp").factory("ToysService",a),a.$inject=["$http","$log","LoginService","$routeParams","$window","$q","SettingsService"]}(),function(){function a(a,b,c){var d=document.createElement("audio"),e=!(!d.canPlayType||!d.canPlayType("audio/mpeg;").replace(/no/,"")),f='<img id="elMurloc" style="display: none" src="images/murloc.0f4bdbff.png" />',g='<audio id="elMurlocTalk" preload="auto"><source src="audio/murloc.mp3" /></audio>',h=a.find("body").eq(0);h.append(f),e&&h.append(g);var i=document.getElementById("elMurloc"),j=document.getElementById("elMurlocTalk"),k="0",l="-500px";return i.style.position="fixed",i.style.bottom=l,i.style.right=k,i.style.display="block",{trigger:function(){c.ga("send","event","Fun","Konami"),j&&j.play();var a=jQuery(i);a.animate({bottom:"30"},function(){a.animate({bottom:"0px"},100,function(){var b=a.position().left+400;a.delay(300).animate({right:b},1750,function(){a.css({bottom:l,right:k})})})})}}}angular.module("simpleArmoryApp").factory("KonamiService",a),a.$inject=["$document","$animate","$window"]}(),function(){function a(a){var b=[],c="38,38,40,40,37,39,37,39,66,65";return{init:function(d){a.bind("keydown",function(a){b.push(a.which),b.toString().indexOf(c)>=0?(b=[],d()):b.length>200&&(b=[])})}}}angular.module("simpleArmoryApp").factory("KeyboardService",a),a.$inject=["$document"]}(),function(){function a(a,b,c,d,e){function f(a,b){var c=[];return angular.forEach(a,function(a){if(a.steps){var d=f(a.steps,b);d.length>0&&(c.push(a),c=c.concat(d),a.finalStep&&c.push({title:a.finalStep,hearth:!0}))}else g(a,b)||c.push(a)}),c}function g(a,b){var c=!0,d=!1,e=[];return a.bosses&&angular.forEach(a.bosses,function(a){void 0!==a.allianceSpellId&&b.isAlliance&&void 0===b.lookup[a.allianceSpellId]?(e.push(a),c=!1):void 0===a.hordeSpellId||b.isAlliance||void 0!==b.lookup[a.hordeSpellId]?(void 0!==a.spellId&&void 0===b.lookup[a.spellId]||d)&&(e.push(a),c=!1):(e.push(a),c=!1)}),a.bosses=e,c}var h;return c.onLogin(function(){h=void 0}),{getSteps:function(g){return h?e.when(h):c.getCharacter({region:d.region,realm:d.realm,character:d.character}).then(function(c){return a.get("data/planner.031cd780.json",{cache:!0}).then(function(a){return b.log("Parsing planner.json..."),h=f(a.data.steps,g)})})}}}angular.module("simpleArmoryApp").factory("PlannerService",a),a.$inject=["$http","$log","LoginService","$routeParams","$q"]}(),function(){function a(a,b,c,d,e){function f(a,c){var d={};d.categories=[];var e={};return b.log("Parsing factions.json..."),angular.forEach(c.reputation,function(a,b){var c=a.value/a.max*100;e[a.id]={level:a.standing,perc:isNaN(c)?100:c,value:a.value,max:a.max}}),angular.forEach(a,function(a){var b={};b.name=a.name,b.factions=[];var c=!1;angular.forEach(a.factions,function(a){var d={};d.id=a.id,d.name=a.name;var f=e[d.id];f&&(h(a.id)?(d.stranger=g(0,f),d.acquaintance=g(1,f),d.buddy=g(2,f),d.friend=g(3,f),d.goodFriends=g(4,f),d.bestFriends=g(5,f),d.value=f.value,d.max=f.max,d.isTiller=!0,c=!0):(d.hated=g(0,f),d.hostel=g(1,f),d.unfriendly=g(2,f),d.neutral=g(3,f),d.friendly=g(4,f),d.honored=g(5,f),d.revered=g(6,f),d.exalted=g(7,f),d.value=f.value,d.max=f.max),b.factions.push(d))}),c&&(b.isTiller=!0),b.factions.length>0&&d.categories.push(b)}),d}function g(a,b){return a===b.level?b.perc:a<b.level?100:0}function h(a){return"1273"===a||"1275"===a||"1276"===a||"1277"===a||"1278"===a||"1279"===a||"1280"===a||"1281"===a||"1282"===a||"1283"===a}var i;return c.onLogin(function(){i=void 0}),{getFactions:function(){return i?e.when(i):c.getCharacter({region:d.region,realm:d.realm,character:d.character}).then(function(b){return a.get("data/factions.2e8b63f6.json",{cache:!0}).then(function(a){return i=f(a.data,b)})})}}}angular.module("simpleArmoryApp").factory("FactionsService",a),a.$inject=["$http","$log","LoginService","$routeParams","$q"]}(),function(){function a(a,b){return{WowHeadUrl:"ru.wowhead.com",apiEndPoint:"https://armorystats.info/character/",anchorTarget:"_blank",debug:b.debug&&"1"===b.debug?!0:!1,fakeCompletionTime:312,jsonFiles:{pets:"data/pets.95e381b8.json",battlepets:"data/battlepets.9f2f636b.json",mounts:"data/mounts.60892cec.json",toys:"data/toys.bf9c47ab.json",achievements:"data/achievements.4ee5f14f.json"}}}angular.module("simpleArmoryApp").factory("SettingsService",a),a.$inject=["$log","$routeParams"]}(),function(){function a(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}angular.module("simpleArmoryApp").directive("ngEnter",a)}(),function(){function a(){return{controller:c,restrict:"E",scope:{faction:"="},templateUrl:function(){return"views/reputationRow.html"}}}angular.module("simpleArmoryApp").directive("saReputationRow",a);var b={hated:150,hostel:25,unfriendly:25,neutral:25,friendly:40,honored:60,revered:85,exalted:10,stranger:50,acquaintance:50,buddy:50,friend:50,goodFriends:50,bestFriends:50},c=function(a,c){a.settings=c,a.getWidth=function(c){var d=a.faction[c]?a.faction[c]:0;return d/100*b[c]+"px"},a.shouldShow=function(b){0===a.faction.max?a.show=!1:a.show=b}};c.$inject=["$scope","SettingsService"]}();